#include "Enemy.h"
#include "Graphics.h"
#include "EnemyManager.h"
#include "Mathf.h"

void Enemy::Destroy()
{
    EnemyManager::Instance().Remove(this);
}

bool Enemy::SearchPlayer()
{

	// プレイヤーとの高低差を考慮して3Dで距離判定をする
	PlayerManager& playerManager = PlayerManager::Instance();
	const DirectX::XMFLOAT3& playerPosition =
		playerManager.GetPlayer(playerManager.GetplayerOneIndex())->GetPosition();
	float vx = playerPosition.x - position.x;
	float vy = playerPosition.y - position.y;
	float vz = playerPosition.z - position.z;
	float dist = sqrtf(vx * vx + vy * vy + vz * vz);

	if (dist < searchRange)
	{
		float distXZ = sqrtf(vx * vx + vz * vz);
		// 単位ベクトル化
		vx /= distXZ;
		vz /= distXZ;

		// 方向ベクトル化
		float frontX = sinf(angle.y);
		float frontZ = cosf(angle.y);
		// 2つのベクトルの内積値で前後判定
		float dot = (frontX * vx) + (frontZ * vz);
		if (dot > 0.0f)
		{
			return true;
		}
	}
	return false;
}

// ターゲット位置をランダム設定
void Enemy::SetRandomTargetPosition()
{
	float theta = Mathf::RandomRange(-DirectX::XM_PI, DirectX::XM_PI);
	float range = Mathf::RandomRange(0.0f, territoryRange);
	targetPosition.x = territoryOrigin.x + sinf(theta) * range;
	targetPosition.y = territoryOrigin.y;
	targetPosition.z = territoryOrigin.z + cosf(theta) * range;
}